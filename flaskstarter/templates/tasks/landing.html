{% from "macros/_form.html" import render_form %} {% set page_title = 'Home' %}
{% extends 'layouts/base.html' %} {% block body %} {% include
'layouts/banner.html' %}

<div class="container">
  <div class="row justify-content-center">
    <div class="intro-h">Dataset Distribution</div>
    <div id="map" style="width: 100vw; height: 100vh"></div>

    <table class="table table-striped">
      <thead><tr><th>Name</th><th>Link</th></tr></thead>
      <tbody>
      {% for val in fdataset %}
      <tr><td>{{val}}</td><td><a href='{{url_for("tasks.table_view", main={"meta_dataset": val}|tojson)}}'>Link</a></td></tr>

      {% endfor %}
      </tbody>
    </table>  

  </div>
</div>

<div class="section02">
    <div class="intro-h">Cell Type Distribution</div>
    <div id="pieChart" style="width: 100vw; height: 100vh"></div>
  </div>

</div>



<div class="section01">

  <div class="container flex-column">
    <div class="intro-h">What is the D²4H Single-cell Data Share?</div>
    <div class="intro-c">
      The D²4H Single-cell Data Share stores and provides over 3.2 million
      single-cell data by 21 published single-cell sequencing datasets. Anyone
      can explore the insights from our analysis and download the data provided
      here for further analysis.
    </div>
    <div class="d-flex justify-content-center">
      <table class="intro-tb">
        <tr>
          <td>
            <img
              src="{{url_for('static', filename='newspaper.png')}}"
              width="140"
              height="140"
            />
          </td>
          <td></td>
          <td>
            <img
              src="{{url_for('static', filename='explore.png')}}"
              width="140"
              height="140"
            />
          </td>
          <td></td>
          <td>
            <img
              src="{{url_for('static', filename='folder.png')}}"
              width="140"
              height="140"
            />
          </td>
        </tr>
        <tr>
          <td>
            <p>Insight</p>
          </td>
          <td></td>
          <td>
            <p>Expore data</p>
          </td>
          <td></td>
          <td>
            <p>Download and Citation</p>
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>

<div class="section02">
  <div class="container flex-column">
    <div class="intro-h">D²4H Single-cell Data Share Life Cycle</div>
    <div class="intro-c">
      The D²4H Single-cell Data Share provides a platform for sharing
      single-cell data. We welcome anyone to contribute on our data sharing
      coummuniaty.
    </div>
    <div class="d-flex justify-content-center">
      <table class="intro-tb">
        <tr>
          <td>
            <img
              src="{{url_for('static', filename='folder-3.png')}}"
              width="140"
              height="140"
            />
          </td>
          <td>
            <img
              src="{{url_for('static', filename='Pointer.png')}}"
              width="95"
              height="95"
            />
          </td>
          <td>
            <img
              src="{{url_for('static', filename='microscope.png')}}"
              width="140"
              height="140"
            />
          </td>
          <td>
            <img
              src="{{url_for('static', filename='Pointer.png')}}"
              width="95"
              height="95"
            />
          </td>
          <td>
            <img
              src="{{url_for('static', filename='folder-2.png')}}"
              width="140"
              height="140"
            />
          </td>
        </tr>
        <tr>
          <td>
            <p>Users contribute single-cell data</p>
          </td>
          <td></td>
          <td>
            <p>D²4H processes the data</p>
          </td>
          <td></td>
          <td>
            <p>Users can find suitable data to download</p>
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}

<script src="https://www.amcharts.com/lib/4/core.js"></script>
<script src="https://www.amcharts.com/lib/4/maps.js"></script>
<script src="https://cdn.amcharts.com/lib/4/geodata/worldLow.js"></script>
<script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>
<script src="https://cdn.amcharts.com/lib/4/charts.js"></script>

<script>

   // Create map instance
   const chart = am4core.create("map", am4maps.MapChart);

   // Set map definition
   chart.geodata = am4geodata_worldLow;

   // Set projection
   chart.projection = new am4maps.projections.Miller();

   chart.deltaLongitude = -160;

   const title = chart.titles.create();

   title.text = "Dataset distribution by Region";
   title.fontFamily = "Inter";
   title.fontSize = 25;
   title.fill = am4core.color("#275950");
   title.align = "left";
   title.paddingTop = 40;
   title.paddingLeft = 30;

   // Create map polygon series
   const polygonSeries = chart.series.push(new am4maps.MapPolygonSeries());

   // Exclude Antartica
   polygonSeries.exclude = ["AQ"];

   // Make map load polygon (like country names) data from GeoJSON
   polygonSeries.useGeodata = true;

   // Configure series
   const polygonTemplate = polygonSeries.mapPolygons.template;

   polygonTemplate.tooltipHTML = '<b>{name}: {value}</b><br><a href="https://en.wikipedia.org/wiki/{name.urlEncode()}">Explore</a>';
   polygonTemplate.fill = am4core.color("rgba(110, 166, 157, 0.5)");

   // Create hover state and set alternative fill color
   const hs = polygonTemplate.states.create("hover");
   hs.properties.fill = am4core.color("#489587");

   // Set up tooltips
   polygonSeries.calculateVisualCenter = true;
   polygonTemplate.tooltipPosition = "fixed";
   polygonSeries.tooltip.label.interactionsEnabled = true;
   polygonSeries.tooltip.keepTargetHover = true;

   // heatRules
   polygonSeries.heatRules.push({
     "target": polygonSeries.mapPolygons.template,
     "property": "fill",
     "min": am4core.color("#1CC5DC"),
     "max": am4core.color("#AA2EE6"),
     "dataField": "value",
   });

   // value
     const data = {{ data|tojson }}
     const objs = []

     for ( let country in data["Country Code"]) {
       let obj = {id: data["Country Code"][country], value: 1}
       console.log(obj)
       if (objs.length > 0) {
        for (let j = 0; j < objs.length; j++) {
          if (objs[j].id == obj.id) {
            let k = objs[j].value;
            objs[j].value = k + 1;
            break;
          } else if (j == objs.length - 1) {
            objs.push(obj);
            break;
          }
        }
      } else {
        objs.push(obj)
      }
     }
     console.log(objs);


   polygonSeries.data = objs;
</script>

<script>
  // Create chart instance
const pieChart = am4core.create("pieChart", am4charts.PieChart);

// Add data
pieChart.data = [{
  "country": "Lithuania",
  "litres": 501.9
}, {
  "type": "B",
  "pieces": 405705
}, {
  "type": "CD14 Mono",
  "pieces": 1038595
}, {
  "type": "CD16 Mono",
  "pieces": 151574
}, {
  "type": "CD4 T",
  "pieces": 1264918
}, {
  "type": "CD8 T",
  "pieces": 453699
}, {
  "type": "DC",
  "pieces": 61060
}, {
  "type": "DN",
  "pieces": 6563
}, {
  "type": "HSPC",
  "pieces": 10593
}, {
  "type": "ILC",
  "pieces": 123
}, {
  "type": "MAIT",
  "pieces": 67890
}, {
  "type": "MAST",
  "pieces": 2436
}, {
  "type": "NK",
  "pieces": 590622
}, {
  "type": "NKT",
  "pieces": 220130
}, {
  "type": "Neutrophil",
  "pieces": 196407
}, {
  "type": "Plasma",
  "pieces": 70265
}, {
  "type": "Platelet",
  "pieces": 82727
}, {
  "type": "RBC",
  "pieces": 23007
}, {
  "type": "gdT",
  "pieces": 83618
}, {
  "type": "intermediate",
  "pieces": 159847
}, {
  "type": "unassigned",
  "pieces": 33979
}];



// Add and configure Series
var pieSeries = pieChart.series.push(new am4charts.PieSeries());
pieSeries.dataFields.value = "pieces";
pieSeries.dataFields.category = "type";
pieSeries.tooltip.label.interactionsEnabled = true;
pieSeries.tooltip.keepTargetHover = true;
pieSeries.slices.template.tooltipHTML = '<b>{type}: {pieces}</b><br><a href="http://localhost:5000/">Explore</a>';
</script>

{% endblock %}